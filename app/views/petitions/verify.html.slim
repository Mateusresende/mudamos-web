section.container-fluid#verify-document
  .container
    h1 Verifique o documento
    div.verify-document
      h3 Carregue o arquivo
      input#document type="file"
      button.rounded-button#verify Verificar

    div.verify-result
      div.result
      button.rounded-button#verify-again Verificar outro documento

    javascript:
      $(document).ready(function() {

        $("#verify-again").click(function() {
          $(".verify-document").slideDown();
          $(".verify-result").slideUp();
          $("#document").val(null);
        });

        var showResult = function(status) {
          if (status) {
            $(".verify-result .result").html(JST["templates/petitions/valid"]({ status: status }));
          } else {
            $(".verify-result .result").html(JST["templates/petitions/invalid"]());
          }

          $(".verify-document").slideUp();
          $(".verify-result").slideDown();
        };

        $("#verify").click(function() {
          if ($("#document").val()) {
            var reader = new FileReader;
            reader.onload = function() {
              //var sha = asmCrypto.SHA256.hex(reader.result);
              // Mocking remove this when we can test with the api
              var sha = "62ace500d79556b3c835f81663a52c6fba44e659b6dcd84f4bfcc2e069b52ee1";
              document.start_loading();
              apiClient.getPetitionStatus(sha)
                .then(function(result) {
                  showResult(result.status);
                  document.stop_loading();
                }).fail(function(err) {
                  showResult();
                  document.stop_loading();
                });
            }

            var input = document.getElementById("document");
            reader.readAsArrayBuffer(input.files[0]);
          } else {
            document.flash_message("Escolha o arquivo para verificar", "error");
          }
        });
      });
